# Standard
import os
import sys
import numpy as np
from matplotlib import pyplot as plt
from datetime import datetime

# Define path to import src files
file_name = os.path.splitext(os.path.basename(__file__))[0]
file_directory = os.path.realpath(__file__)
for _ in range(5):
    file_directory = os.path.dirname(file_directory)
    sys.path.append(file_directory)

from tests import utils, helper_functions
from src import NavigationSimulator, PlotNavigationResults




#################################################################
###### Fixed arc durations ######################################
#################################################################

### Run the navigation routines for varying observation windows
start_epoch = 60390
runs = 3
models = ["PMSRP"]
durations = [28]
thresholds = [1]
custom_station_keeping_errors = [1e-10]
custom_target_point_epochs = [3]
custom_range_noises = [2.98]
skm_to_od_durations = [3]
od_durations = [0.1, 0.2, 0.5, 1, 1.5]
custom_initial_estimation_error = np.array([5e2, 5e2, 5e2, 1e-3, 1e-3, 1e-3, 5e2, 5e2, 5e2, 1e-3, 1e-3, 1e-3])*1e0
custom_apriori_covariance = np.diag([1e3, 1e3, 1e3, 1e-2, 1e-2, 1e-2, 1e3, 1e3, 1e3, 1e-2, 1e-2, 1e-2])**2
custom_orbit_insertion_error = np.array([0, 0, 0, 0, 0, 0, 1e3, 1e3, 1e3, 1e-2, 1e-2, 1e-2])*1e0


current_time_string = datetime.now().strftime("%d%m%H%M")




navigation_results_dict = {}

delta_v_dict_per_run = {}
input_dict = {}

input_dict["runs"] = runs
input_dict["models"] = models
input_dict["durations"] = durations
input_dict["thresholds"] = thresholds
input_dict["custom_station_keeping_errors"] = custom_station_keeping_errors
input_dict["custom_target_point_epochs"] = custom_target_point_epochs
input_dict["custom_range_noises"] = custom_range_noises
input_dict["skm_to_od_durations"] = skm_to_od_durations
input_dict["od_durations"] = od_durations
input_dict["custom_initial_estimation_error"] = list(custom_initial_estimation_error)
input_dict["custom_apriori_covariance"] = list(np.diagonal(custom_apriori_covariance))
input_dict["custom_orbit_insertion_error"] = list(custom_orbit_insertion_error)

delta_v_dict_per_run["inputs"] = input_dict

print(delta_v_dict_per_run)



data = {
        "0": {
                "PMSRP": {
                        "28": {
                                "1": {
                                        "1e-10": {
                                                "3": {
                                                        "1": {
                                                                "0.1": [
                                                                        0.12530869701539718,
                                                                        0.0006073582675855771,
                                                                        0.026154409614650587,
                                                                        614780.4400309983,
                                                                        25
                                                                ],
                                                                "0.2": [
                                                                        0.0963136965774001,
                                                                        0.0003432551981287958,
                                                                        0.03455196696497851,
                                                                        614917.447424306,
                                                                        23
                                                                ],
                                                                "0.5": [
                                                                        0.13516014333429338,
                                                                        0.0003231071992950053,
                                                                        0.02984790095234822,
                                                                        632351.5314905663,
                                                                        19
                                                                ],
                                                                "1": [
                                                                        0.10178966670743898,
                                                                        0.0017912704756358998,
                                                                        0.03239655441086468,
                                                                        600395.9265504743,
                                                                        14
                                                                ],
                                                                "1.5": [
                                                                        0.12356999073487253,
                                                                        0.0024670651403456163,
                                                                        0.03453235040544605,
                                                                        575322.8807566395,
                                                                        11
                                                                ]
                                                        },
                                                        "2": {
                                                                "0.1": [
                                                                        0.15259458023949735,
                                                                        0.002064188035128956,
                                                                        0.04715490387865108,
                                                                        582497.5127043762,
                                                                        13
                                                                ],
                                                                "0.2": [
                                                                        0.12282443784732479,
                                                                        0.0006475988126756288,
                                                                        0.026932620973419235,
                                                                        614993.9974628668,
                                                                        13
                                                                ],
                                                                "0.5": [
                                                                        0.14021761649148728,
                                                                        0.0016705454292732604,
                                                                        0.04179408997247897,
                                                                        575324.3909713136,
                                                                        11
                                                                ],
                                                                "1": [
                                                                        0.18710074109637276,
                                                                        0.002195575763250168,
                                                                        0.055425749387960535,
                                                                        632331.5813053367,
                                                                        10
                                                                ],
                                                                "1.5": [
                                                                        0.14980919446839733,
                                                                        0.006501749297991242,
                                                                        0.035046618781723375,
                                                                        568672.9506278947,
                                                                        8
                                                                ]
                                                        },
                                                        "3": {
                                                                "0.1": [
                                                                        0.14686895822198465,
                                                                        0.003863885478504952,
                                                                        0.04001477125394396,
                                                                        575285.4960080968,
                                                                        9
                                                                ],
                                                                "0.2": [
                                                                        0.17391286228787076,
                                                                        0.005266792911250204,
                                                                        0.04432722237341661,
                                                                        582508.3637240827,
                                                                        9
                                                                ],
                                                                "0.5": [
                                                                        0.17113257357379155,
                                                                        0.0038431834351128112,
                                                                        0.040500395946033364,
                                                                        568709.5902455687,
                                                                        8
                                                                ],
                                                                "1": [
                                                                        0.23224005013253385,
                                                                        0.014864695003711287,
                                                                        0.06744222876434655,
                                                                        558569.9374068311,
                                                                        7
                                                                ],
                                                                "1.5": [
                                                                        0.26050930586274207,
                                                                        0.012939296863649054,
                                                                        0.07793903381641219,
                                                                        632362.7923378423,
                                                                        7
                                                                ]
                                                        },
                                                        "4": {
                                                                "0.1": [
                                                                        0.11861555337623884,
                                                                        0.005443438514002112,
                                                                        0.03146121574374306,
                                                                        568751.9806921816,
                                                                        7
                                                                ],
                                                                "0.2": [
                                                                        0.2760455617113055,
                                                                        0.0074655873210699355,
                                                                        0.13175494825799483,
                                                                        582469.1992914608,
                                                                        7
                                                                ],
                                                                "0.5": [
                                                                        0.43372046976582496,
                                                                        0.01725427003780756,
                                                                        0.1578179350337652,
                                                                        632281.5690648123,
                                                                        7
                                                                ],
                                                                "1": [
                                                                        0.6145057917204115,
                                                                        0.025028460102551834,
                                                                        0.21383958889117471,
                                                                        575328.3406823138,
                                                                        6
                                                                ],
                                                                "1.5": [
                                                                        0.28800416922511135,
                                                                        0.021512267189667044,
                                                                        0.11470276866274767,
                                                                        500546.1286741484,
                                                                        5
                                                                ]
                                                        }
                                                }
                                        },
                                        "0.02": {
                                                "3": {
                                                        "1": {
                                                                "0.1": [
                                                                        0.12850595019232877,
                                                                        0.000510723411586339,
                                                                        0.028758827348130962,
                                                                        614691.6694392179,
                                                                        25
                                                                ],
                                                                "0.2": [
                                                                        0.09555630802438048,
                                                                        0.00044295961022781136,
                                                                        0.03121213895473615,
                                                                        614941.9790356252,
                                                                        23
                                                                ],
                                                                "0.5": [
                                                                        0.12223146128735274,
                                                                        0.0010149905703430815,
                                                                        0.02849183280319329,
                                                                        632366.9439557169,
                                                                        19
                                                                ],
                                                                "1": [
                                                                        0.09611353554783067,
                                                                        0.0015007665510984242,
                                                                        0.03167047434775677,
                                                                        600370.523904715,
                                                                        14
                                                                ],
                                                                "1.5": [
                                                                        0.10137052498237709,
                                                                        0.0021600838292197932,
                                                                        0.03202404255438817,
                                                                        575298.0309163536,
                                                                        11
                                                                ]
                                                        },
                                                        "2": {
                                                                "0.1": [
                                                                        0.15625715235517396,
                                                                        0.0016610624930249861,
                                                                        0.04753047075441211,
                                                                        582490.0275170683,
                                                                        13
                                                                ],
                                                                "0.2": [
                                                                        0.13061233096746197,
                                                                        0.0019831690229389935,
                                                                        0.029761448815810394,
                                                                        615087.4462735824,
                                                                        13
                                                                ],
                                                                "0.5": [
                                                                        0.1329973824280436,
                                                                        0.0021531156341718584,
                                                                        0.03567477771139023,
                                                                        575314.7558006586,
                                                                        11
                                                                ],
                                                                "1": [
                                                                        0.19941322247369977,
                                                                        0.0010025973247860186,
                                                                        0.05020756436790117,
                                                                        632312.0981097658,
                                                                        10
                                                                ],
                                                                "1.5": [
                                                                        0.18238806246251926,
                                                                        0.009938414360489032,
                                                                        0.04362090863578233,
                                                                        568628.1353485505,
                                                                        8
                                                                ]
                                                        },
                                                        "3": {
                                                                "0.1": [
                                                                        0.1630993390233132,
                                                                        0.005168294853064711,
                                                                        0.04304065981340751,
                                                                        575243.0530830898,
                                                                        9
                                                                ],
                                                                "0.2": [
                                                                        0.1567918553128787,
                                                                        0.006276447354287089,
                                                                        0.032113804783563064,
                                                                        582469.1087912495,
                                                                        9
                                                                ],
                                                                "0.5": [
                                                                        0.19386811920542046,
                                                                        0.003069348641629148,
                                                                        0.04900456656687556,
                                                                        568737.2810278551,
                                                                        8
                                                                ],
                                                                "1": [
                                                                        0.282942652695778,
                                                                        0.0047912031084811285,
                                                                        0.10050292223391909,
                                                                        558592.1079139186,
                                                                        7
                                                                ],
                                                                "1.5": [
                                                                        0.2847886730940633,
                                                                        0.01794902157214876,
                                                                        0.06939597479970556,
                                                                        632367.597962445,
                                                                        7
                                                                ]
                                                        },
                                                        "4": {
                                                                "0.1": [
                                                                        0.18887200200657422,
                                                                        0.009642573892737441,
                                                                        0.04992650327937745,
                                                                        568699.4577145262,
                                                                        7
                                                                ],
                                                                "0.2": [
                                                                        0.3152476150456837,
                                                                        0.005439680707279437,
                                                                        0.165804623257794,
                                                                        582494.4206668002,
                                                                        7
                                                                ],
                                                                "0.5": [
                                                                        0.23903302883185473,
                                                                        0.005129510087926919,
                                                                        0.10148512285091783,
                                                                        632371.2262531994,
                                                                        7
                                                                ],
                                                                "1": [
                                                                        0.38051755716648333,
                                                                        0.026238525421320952,
                                                                        0.11270244390000861,
                                                                        575289.1790340743,
                                                                        6
                                                                ],
                                                                "1.5": [
                                                                        0.5527322421294092,
                                                                        0.024711925854526993,
                                                                        0.19151379931746357,
                                                                        500484.32705211744,
                                                                        5
                                                                ]
                                                        }
                                                }
                                        }
                                }
                        }
                }
        },
        "1": {
                "PMSRP": {
                        "28": {
                                "1": {
                                        "1e-10": {
                                                "3": {
                                                        "1": {
                                                                "0.1": [
                                                                        0.13283810951447467,
                                                                        0.0007096099406824627,
                                                                        0.02714912501958794,
                                                                        614810.839304927,
                                                                        25
                                                                ],
                                                                "0.2": [
                                                                        0.10336291057804793,
                                                                        0.0003032804544185327,
                                                                        0.02626047201213913,
                                                                        614981.7735697886,
                                                                        23
                                                                ],
                                                                "0.5": [
                                                                        0.10961182759308756,
                                                                        0.0007411768351444593,
                                                                        0.03398596994331205,
                                                                        632356.7963787606,
                                                                        19
                                                                ],
                                                                "1": [
                                                                        0.10926496655787912,
                                                                        0.0014059213118405311,
                                                                        0.027420447365759035,
                                                                        600389.4308827015,
                                                                        14
                                                                ],
                                                                "1.5": [
                                                                        0.09433999807614298,
                                                                        0.0022335763426081564,
                                                                        0.032744740151616165,
                                                                        575325.4061883243,
                                                                        11
                                                                ]
                                                        },
                                                        "2": {
                                                                "0.1": [
                                                                        0.15703659185302588,
                                                                        0.0012045605605464594,
                                                                        0.04757774515575516,
                                                                        582498.2348839078,
                                                                        13
                                                                ],
                                                                "0.2": [
                                                                        0.10702059608312094,
                                                                        0.001738760824921743,
                                                                        0.03152798293198757,
                                                                        615085.2515527796,
                                                                        13
                                                                ],
                                                                "0.5": [
                                                                        0.1345987276137482,
                                                                        0.0013612828914404986,
                                                                        0.03769696434328528,
                                                                        575260.4973905503,
                                                                        11
                                                                ],
                                                                "1": [
                                                                        0.22681689351376863,
                                                                        0.0021213160461340426,
                                                                        0.055859888337137564,
                                                                        632279.2781313553,
                                                                        10
                                                                ],
                                                                "1.5": [
                                                                        0.14464984009652795,
                                                                        0.006132094942992034,
                                                                        0.032109470621502,
                                                                        568736.9612201924,
                                                                        8
                                                                ]
                                                        },
                                                        "3": {
                                                                "0.1": [
                                                                        0.1439690441353655,
                                                                        0.0038682469315072508,
                                                                        0.040821451210776974,
                                                                        575263.0900737008,
                                                                        9
                                                                ],
                                                                "0.2": [
                                                                        0.16854536137130302,
                                                                        0.00714357280705874,
                                                                        0.0349200678809872,
                                                                        582541.5464784884,
                                                                        9
                                                                ],
                                                                "0.5": [
                                                                        0.17607308474331557,
                                                                        0.0009021900364503655,
                                                                        0.053780278357542184,
                                                                        568702.5101304752,
                                                                        8
                                                                ],
                                                                "1": [
                                                                        0.26697252615588596,
                                                                        0.01731217260647267,
                                                                        0.08334072860680915,
                                                                        558590.7510040202,
                                                                        7
                                                                ],
                                                                "1.5": [
                                                                        0.3642088894101261,
                                                                        0.013377307675397021,
                                                                        0.15136653660652363,
                                                                        632351.0771395669,
                                                                        7
                                                                ]
                                                        },
                                                        "4": {
                                                                "0.1": [
                                                                        0.12076971770723761,
                                                                        0.006965717462679275,
                                                                        0.03597569539081787,
                                                                        568698.3511014666,
                                                                        7
                                                                ],
                                                                "0.2": [
                                                                        0.2247330069905733,
                                                                        0.005195048511584364,
                                                                        0.09657138596611729,
                                                                        582512.6015248336,
                                                                        7
                                                                ],
                                                                "0.5": [
                                                                        0.2214438519226478,
                                                                        0.005725962744755814,
                                                                        0.07887416773861172,
                                                                        632237.6526751705,
                                                                        7
                                                                ],
                                                                "1": [
                                                                        0.1651443484711181,
                                                                        0.01773762370683432,
                                                                        0.04129669329427451,
                                                                        575291.4948674679,
                                                                        6
                                                                ],
                                                                "1.5": [
                                                                        0.5127937295548888,
                                                                        0.025870420173708848,
                                                                        0.17966707452575428,
                                                                        500454.30204288824,
                                                                        5
                                                                ]
                                                        }
                                                }
                                        },
                                        "0.02": {
                                                "3": {
                                                        "1": {
                                                                "0.1": [
                                                                        0.1091536921443702,
                                                                        0.0009661141818512707,
                                                                        0.033102176357232234,
                                                                        614768.1378300397,
                                                                        25
                                                                ],
                                                                "0.2": [
                                                                        0.0982026447531502,
                                                                        0.0006451805033742955,
                                                                        0.03463478029928699,
                                                                        614921.3592808325,
                                                                        23
                                                                ],
                                                                "0.5": [
                                                                        0.12263860581397389,
                                                                        0.00016323400401831875,
                                                                        0.029103844586837437,
                                                                        632326.2487117345,
                                                                        19
                                                                ],
                                                                "1": [
                                                                        0.11883531055751302,
                                                                        0.0018082913974772732,
                                                                        0.030745799237671245,
                                                                        600363.2981379572,
                                                                        14
                                                                ],
                                                                "1.5": [
                                                                        0.09014841412407053,
                                                                        0.002142304268664442,
                                                                        0.03324010730095234,
                                                                        575345.2521270904,
                                                                        11
                                                                ]
                                                        },
                                                        "2": {
                                                                "0.1": [
                                                                        0.17654547078240304,
                                                                        0.0022440290315356355,
                                                                        0.05130121453246959,
                                                                        582524.8487476293,
                                                                        13
                                                                ],
                                                                "0.2": [
                                                                        0.12171820420425757,
                                                                        0.0011582417604198041,
                                                                        0.028074175658741936,
                                                                        615065.5249228012,
                                                                        13
                                                                ],
                                                                "0.5": [
                                                                        0.136494230313979,
                                                                        0.0011302516019122061,
                                                                        0.0385670408270231,
                                                                        575297.7764521233,
                                                                        11
                                                                ],
                                                                "1": [
                                                                        0.18728821225548672,
                                                                        0.000665120958277751,
                                                                        0.055727611141412586,
                                                                        632271.1046619817,
                                                                        10
                                                                ],
                                                                "1.5": [
                                                                        0.21153065183227573,
                                                                        0.010291112214856743,
                                                                        0.05086762973073931,
                                                                        568693.123454708,
                                                                        8
                                                                ]
                                                        },
                                                        "3": {
                                                                "0.1": [
                                                                        0.16393516024610966,
                                                                        0.002303499764661653,
                                                                        0.041805365016801745,
                                                                        575269.0855325052,
                                                                        9
                                                                ],
                                                                "0.2": [
                                                                        0.17585549992532362,
                                                                        0.006664781922546338,
                                                                        0.046539075370016315,
                                                                        582551.5245053403,
                                                                        9
                                                                ],
                                                                "0.5": [
                                                                        0.16989522849020527,
                                                                        0.0022265783594727913,
                                                                        0.048567067910320276,
                                                                        568667.6668949798,
                                                                        8
                                                                ],
                                                                "1": [
                                                                        0.22641693512045763,
                                                                        0.004533250399566626,
                                                                        0.07575120947826702,
                                                                        558585.4004950295,
                                                                        7
                                                                ],
                                                                "1.5": [
                                                                        0.4017821245968432,
                                                                        0.02131734938989188,
                                                                        0.15860608214162236,
                                                                        632265.8349462232,
                                                                        7
                                                                ]
                                                        },
                                                        "4": {
                                                                "0.1": [
                                                                        0.22989590659700104,
                                                                        0.010195128050244886,
                                                                        0.061617873222729456,
                                                                        568709.0995503413,
                                                                        7
                                                                ],
                                                                "0.2": [
                                                                        0.257815770015976,
                                                                        0.014534987625146514,
                                                                        0.10024095883660851,
                                                                        582459.8964208626,
                                                                        7
                                                                ],
                                                                "0.5": [
                                                                        0.6257758667679101,
                                                                        0.013320109861920375,
                                                                        0.2535757602194603,
                                                                        632334.8180784505,
                                                                        7
                                                                ],
                                                                "1": [
                                                                        0.15104072947054056,
                                                                        0.0033898585939644336,
                                                                        0.037136161422463336,
                                                                        575236.4253029918,
                                                                        6
                                                                ],
                                                                "1.5": [
                                                                        0.4348528161624825,
                                                                        0.029258763025608887,
                                                                        0.1854539130167133,
                                                                        500504.0127490554,
                                                                        5
                                                                ]
                                                        }
                                                }
                                        }
                                }
                        }
                }
        }
}
delta_v_dict_per_run.update(data)

utils.save_dicts_to_folder(dicts=[delta_v_dict_per_run], labels=[current_time_string+"_delta_v_dict_constant_arc"], custom_sub_folder_name=file_name)




for run in range(runs):

    delta_v_dict_per_model = {}
    for model in models:

        delta_v_dict_per_duration = {}
        for duration in durations:

            delta_v_dict_per_threshold = {}
            for threshold in thresholds:

                delta_v_dict_per_station_keeping_error = {}
                for custom_station_keeping_error in custom_station_keeping_errors:

                    delta_v_dict_per_target_point_epoch = {}
                    for custom_target_point_epoch in custom_target_point_epochs:

                        delta_v_dict_per_range_noise = {}
                        for custom_range_noise in custom_range_noises:

                            delta_v_dict_per_skm_to_od_duration = {}
                            for skm_to_od_duration in skm_to_od_durations:

                                delta_v_dict_per_od_duration = {}
                                for od_duration in od_durations:

                                    # objective_value = np.random.randint(1, 100)
                                    # delta_v_dict_per_od_duration[od_duration] = objective_value

                                    # Generate a vector with OD durations
                                    epoch = start_epoch + threshold + skm_to_od_duration + od_duration
                                    skm_epochs = []
                                    i = 1
                                    while True:
                                        if epoch <= start_epoch+duration:
                                            skm_epochs.append(epoch)
                                            epoch += skm_to_od_duration+od_duration
                                        else:
                                            design_vector = od_duration*np.ones(np.shape(skm_epochs))
                                            break
                                        i += 1

                                    # Extract observation windows
                                    observation_windows = [(start_epoch, start_epoch+threshold)]
                                    for i, skm_epoch in enumerate(skm_epochs):
                                        observation_windows.append((skm_epoch-od_duration, skm_epoch))

                                    station_keeping_epochs = [windows[1] for windows in observation_windows]

                                    # Start running the navigation routine
                                    navigation_simulator = NavigationSimulator.NavigationSimulator(observation_windows,
                                                                                                    ["HF", model, 0],
                                                                                                    ["HF", model, 0],
                                                                                                    step_size=1e-2,
                                                                                                    station_keeping_epochs=station_keeping_epochs,
                                                                                                    target_point_epochs=[custom_target_point_epoch],
                                                                                                    custom_range_noise=custom_range_noise,
                                                                                                    custom_station_keeping_error=custom_station_keeping_error,
                                                                                                    custom_initial_estimation_error=custom_initial_estimation_error,
                                                                                                    custom_apriori_covariance=custom_apriori_covariance,
                                                                                                    custom_orbit_insertion_error=custom_orbit_insertion_error)

                                    navigation_output = navigation_simulator.perform_navigation()
                                    navigation_results = navigation_output.navigation_results
                                    navigation_simulator = navigation_output.navigation_simulator

                                    full_reference_state_deviation_history = navigation_results[1][1]

                                    reference_state_deviations = np.linalg.norm(full_reference_state_deviation_history[:,:3], axis=1)

                                    navigation_results_dict[od_duration] = navigation_results

                                    delta_v = navigation_results[8][1]
                                    delta_v_norm = np.linalg.norm(delta_v, axis=1)
                                    objective_value = np.sum(np.linalg.norm(delta_v, axis=1))
                                    print(f"Objective: \n", delta_v, objective_value)
                                    print("End of objective calculation ===============")

                                    delta_v_dict_per_od_duration[od_duration] = [objective_value, min(delta_v_norm), max(delta_v_norm), max(reference_state_deviations), len(navigation_simulator.station_keeping_epochs)]

                                delta_v_dict_per_skm_to_od_duration[skm_to_od_duration] = delta_v_dict_per_od_duration

                            delta_v_dict_per_range_noise[custom_range_noise] = delta_v_dict_per_skm_to_od_duration

                        delta_v_dict_per_target_point_epoch[custom_target_point_epoch] = delta_v_dict_per_skm_to_od_duration

                    delta_v_dict_per_station_keeping_error[custom_station_keeping_error] = delta_v_dict_per_target_point_epoch

                delta_v_dict_per_threshold[threshold] = delta_v_dict_per_station_keeping_error

            delta_v_dict_per_duration[duration] = delta_v_dict_per_threshold

        delta_v_dict_per_model[model] = delta_v_dict_per_duration

    delta_v_dict_per_run[run] = delta_v_dict_per_model

print(navigation_results_dict)
print(delta_v_dict_per_run)

utils.save_dicts_to_folder(dicts=[delta_v_dict_per_run], labels=[current_time_string+"_delta_v_dict_constant_arc"], custom_sub_folder_name=file_name)



# ### Run the navigation routines for varying observation windows
# run=True
# dynamic_model_list = ["HF", "PM", 0]
# truth_model_list = ["HF", "PM", 0]
# duration = 28
# skm_to_od_duration = 3
# threshold = 3
# od_duration = 1
# runs = 10
# mean = od_duration
# std_dev = 0.3
# custom_station_keeping_error = 1e-2

# if run:
#     navigation_results_dict = {}
#     delta_v_dict = {}
#     for model in ["PM", "PMSRP"]:

#         np.random.seed(0)
#         delta_v_dict_per_run = {}
#         for run in range(runs):

#             # Generate a vector with OD durations
#             od_durations = np.random.normal(loc=mean, scale=std_dev, size=(20))
#             start_epoch = 60390
#             epoch = start_epoch + threshold + skm_to_od_duration + od_durations[0]
#             skm_epochs = []
#             i = 1
#             while True:
#                 if epoch < start_epoch+duration:
#                     skm_epochs.append(epoch)
#                     epoch += skm_to_od_duration+od_durations[i]
#                 else:
#                     design_vector = np.ones(np.shape(skm_epochs))
#                     break
#                 i += 1

#             # Extract observation windows
#             observation_windows = [(start_epoch, start_epoch+threshold)]
#             for i, skm_epoch in enumerate(skm_epochs):
#                 observation_windows.append((skm_epoch-od_durations[i], skm_epoch))

#             # Start running the navigation routine
#             navigation_simulator = NavigationSimulator.NavigationSimulator(observation_windows,
#                                                                             ["HF", model, 0],
#                                                                             ["HF", model, 0],
#                                                                             station_keeping_epochs=skm_epochs,
#                                                                             target_point_epochs=[3],
#                                                                             custom_station_keeping_error=custom_station_keeping_error,
#                                                                             step_size=1e-2)

#             navigation_results = navigation_simulator.perform_navigation().navigation_results

#             navigation_results_dict[run] = navigation_results

#             delta_v = navigation_results[8][1]
#             objective_value = np.sum(np.linalg.norm(delta_v, axis=1))
#             print(f"Objective: \n", delta_v, objective_value)
#             print("End of objective calculation ===============")

#             delta_v_dict_per_run[run] = [list(od_durations[:len(design_vector)]), objective_value]

#         delta_v_dict[model] = delta_v_dict_per_run

#     print(navigation_results_dict)
#     print(delta_v_dict)

#     utils.save_dicts_to_folder(dicts=[delta_v_dict], labels=[f"delta_v_dict_variable_arc_duration_{custom_station_keeping_error}"], custom_sub_folder_name=file_name)